<!DOCTYPE html>
<html lang="th" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>สรุปสถิติการสนับสนุน</title>
    <style>
        body{font-family:system-ui,Arial,sans-serif;margin:24px}
        .cards{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
        .card{border:1px solid #ddd;border-radius:12px;padding:16px;text-align:center}
        .big{font-size:28px;font-weight:700}
        table{width:100%;border-collapse:collapse;margin-top:16px}
        th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
        @media(max-width:900px){.cards{grid-template-columns:1fr}}
        .meta{color:#666}
        .btn{padding:6px 10px;border:1px solid #ccc;border-radius:8px;background:#fafafa;cursor:pointer}
    </style>
</head>
<body>

<a class="btn" th:href="@{/home}">← กลับหน้ารวม</a>
<h1>สรุปสถิติ</h1>
<p class="meta">ผู้ใช้: <b th:text="${username}">user</b></p>

<section class="cards">
    <div class="card">
        <div>จำนวนการสนับสนุนทั้งหมด</div>
        <div class="big" th:text="${totalPledges}">0</div>
    </div>
    <div class="card">
        <div>สำเร็จ</div>
        <div class="big" th:text="${approvedPledges}">0</div>
    </div>
    <div class="card">
        <div>ถูกปฏิเสธ</div>
        <div class="big" th:text="${failedPledges}">0</div>
    </div>
</section>

<h2 style="margin-top:20px">สรุปต่อโครงการ</h2>
<table>
    <thead>
    <tr>
        <th>โครงการ</th>
        <th>จำนวนการสนับสนุน</th>
        <th>ยอดที่ระดมได้ (เฉพาะอนุมัติ)</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="s : ${projectStats}">
        <td th:text="${s.projectName}">Project A</td>
        <td th:text="${s.pledgeCount}">0</td>
        <td th:text="${#numbers.formatDecimal(s.raisedAmount,0,'COMMA',2,'POINT')}">0.00</td>
    </tr>
    <tr th:if="${#lists.isEmpty(projectStats)}"><td colspan="3">ยังไม่มีข้อมูล</td></tr>
    </tbody>
</table>

<h2 style="margin-top:24px">ประวัติคำขอของฉัน</h2>
<table>
    <thead>
    <tr>
        <th>วันเวลา</th>
        <th>โครงการ</th>
        <th>รางวัล</th>
        <th>จำนวนเงิน</th>
        <th>สถานะ</th>
        <th>เหตุผล (ถ้ามี)</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="h : ${histories}">
        <td th:text="${#temporals.format(h.createdAt,'yyyy-MM-dd HH:mm')}">2025-01-01 10:00</td>
        <td th:text="${h.project.name}">Smart Sensor Kit</td>
        <td th:text="${h.rewardTier == null ? '-' : h.rewardTier.title}">Supporter</td>
        <td th:text="${#numbers.formatDecimal(h.amount,0,'COMMA',2,'POINT')}">200.00</td>
        <td th:text="${h.status}">APPROVED</td>
        <td th:text="${h.reason}">Amount below minimum</td>
    </tr>
    <tr th:if="${#lists.isEmpty(histories)}"><td colspan="6">ยังไม่มีประวัติ</td></tr>
    </tbody>
</table>

</body>
</html>
